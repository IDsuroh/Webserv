# test/webserv_for_tester.conf
# Used when running from /Webserv

server {
    listen      127.0.0.1:8080;
    server_name localhost;

    # Base root: point to the test folder
    # "/" will serve from /Webserv/test
    root        ./test;
    index       index.html;

    client_max_body_size 1M;

    # ------------------------------------------------
    # 1) "/" must answer to GET request ONLY
    #    -> maps to /Webserv/test/...
    # ------------------------------------------------
    location / {
        methods     GET;
        autoindex   off;
    }

    # ------------------------------------------------
    # 2) "/put_test/*" must answer to PUT and save files
    #    -> store to /Webserv/test/uploads
    # ------------------------------------------------
    location /put_test {
        methods      PUT;
        autoindex    off;

        upload_store ./test/uploads;
    }

    # ------------------------------------------------
    # 3) "/post_body" must answer to POST
    #    with maxBody of 100 bytes
    # ------------------------------------------------
    location /post_body {
        methods              POST;
        autoindex            off;
        client_max_body_size 100;
    }

    # ------------------------------------------------
    # 4) "/directory/":
    #   - GET (normal)
    #   - POST on *.bla -> run CGI
    #   - root = /Webserv/test/YoupiBanane
    #   - when no file requested, use youpi.bad_extension
    # ------------------------------------------------
    location /directory {
        methods     GET POST;

        # /directory/... -> /Webserv/test/YoupiBanane/...
        root        ./test/YoupiBanane;
        index       youpi.bad_extension;
        autoindex   off;

        # *.bla under /directory with POST:
        # use /Webserv/test/cgi_tester as CGI
        cgi_pass    .bla ./test/cgi_tester;
    }
}
